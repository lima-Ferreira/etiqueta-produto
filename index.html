<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <title>Etiqueta de Identificação</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f8f8ff;
            margin: 0;
            padding: 0;
            height: 100vh;
            /* altura total da tela */
        }

        header {
            background: purple;
            color: white;
            text-align: center;
            padding: 15px;
            font-size: 20px;
            font-weight: bold;
            letter-spacing: 2px;
        }

        main {
            max-width: 700px;
            margin: 20px auto;
            background: #fff;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            overflow: auto;
            /* permite rolagem só dentro do form, se necessário */
        }

        label {
            display: block;
            margin-top: 10px;
            font-weight: bold;
            color: purple;
        }

        input,
        textarea {
            width: 100%;
            padding: 8px;
            margin-top: 5px;
            border: 1px solid #ccc;
            border-radius: 6px;
        }

        textarea {
            resize: none;
        }

        .buttons {
            margin-top: 20px;
            display: flex;
            justify-content: space-between;
        }

        button {
            flex: 1;
            margin: 5px;
            padding: 10px;
            font-size: 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: 0.3s;
        }

        .save {
            background: purple;
            color: white;
        }

        .save:hover {
            background: darkmagenta;
        }

        .clear {
            background: #ccc;
        }

        .clear:hover {
            background: #999;
            color: white;
        }
    </style>
</head>

<body>
    <header>ETIQUETA DE IDENTIFICAÇÃO</header>
    <main>
        <form id="etiquetaForm">
            <label>Nome: <input type="text" name="nome"></label>

            <div style="display: flex; gap: 20px; align-items: flex-start;">
                <label style="flex: 4;">Endereço: <input type="text" name="endereco"></label>
                <div style=" flex: 1; display: flex; flex-direction: column;">
                    <label>Número:</label>
                    <input type="text" name="numero" style="width: 100%;">
                </div>
            </div>


            <label>Bairro: <input type="text" name="bairro"></label>
            <label>Telefone: <input type="text" name="telefone"></label>
            <label>Produtos: <input type="text" name="produtos"></label>

            <label>Número da Venda: <input type="text" name="venda"></label>
            <label>Número da Nota: <input type="text" name="nota"></label>
            <label>Número de Série: <input type="text" name="serie"></label>
            <label>Número da OS: <input type="text" name="os da loja"></label>
            <label>Ordem de Serviços: <input type="text" name="ordem de Serviços"></label>
            <label>Defeito: <input type="text" name="defeito"></label>

            <div class="buttons">
                <button type="button" class="save" onclick="salvarGerarPDF()">Salvar & Gerar PDF</button>
                <button type="button" class="clear" onclick="limparFormulario()">Limpar Formulário</button>
            </div>
        </form>

    </main>

    <script>
        const form = document.getElementById("etiquetaForm");

        // Carregar dados do localStorage
        window.onload = () => {
            const dados = JSON.parse(localStorage.getItem("etiqueta")) || {};
            Object.keys(dados).forEach(campo => {
                form.elements[campo].value = dados[campo];
            });
        };


        function salvarGerarPDF() {
            const dados = {};
            for (let el of form.elements) {
                if (el.name) dados[el.name] = el.value;
            }
            localStorage.setItem("etiqueta", JSON.stringify(dados));

            const { jsPDF } = window.jspdf;
            const doc = new jsPDF({ unit: 'mm', format: 'a4' });

            const margin = 10;
            const pageWidth = doc.internal.pageSize.getWidth();

            // Header
            let y = 3; // pequena margem superior
            const headerText = "ETIQUETA DE IDENTIFICAÇÃO";
            doc.setFont("helvetica", "bold");
            doc.setFontSize(14);
            doc.setTextColor(0, 0, 0);
            doc.text(headerText.toUpperCase(), pageWidth / 2, y + 5, { align: "center" });
            y += 12; // margem abaixo do header

            const padding = 3;
            const lineHeight = 3.2; // altura de linha menor
            const contentX = margin;
            let contentY = y;
            const contentWidth = pageWidth - 2 * margin - 2 * padding;

            // Preparar linhas e calcular altura do conteúdo
            const linhas = [];
            let contentHeight = 0;
            for (let campo in dados) {
                let label = campo.toUpperCase() + ": ";
                let value = dados[campo].toUpperCase();
                linhas.push({ campo: campo.toLowerCase(), label, value });
                contentHeight += lineHeight + 1.5;
            }

            contentHeight += 0; // espaço extra no final para borda respirar

            // Borda principal
            doc.setDrawColor(50, 50, 50);
            doc.setLineWidth(0.5);
            doc.rect(contentX, contentY, contentWidth + 2 * padding, contentHeight + 2 * padding);

            // Inserir texto
            let textY = contentY + padding + 2;
            for (let i = 0; i < linhas.length; i++) {
                const { label, value } = linhas[i];

                doc.setFont("helvetica", "bold");
                doc.setFontSize(8);
                doc.text(label, contentX + padding, textY);

                doc.setFont("helvetica", "normal");
                doc.setFontSize(8);
                const splitText = doc.splitTextToSize(value, contentWidth - doc.getTextWidth(label));
                doc.text(splitText, contentX + padding + doc.getTextWidth(label), textY);

                textY += Math.max(splitText.length, 1) * lineHeight + 1.5;
            }

            // Linha pontilhada + tesoura (mais afastada da borda)
            const corteY = contentY + contentHeight + padding + 6;
            doc.setLineWidth(0.1);
            doc.setDrawColor(0, 0, 0);
            const dashLength = 2;
            for (let i = contentX; i < contentX + contentWidth + 2 * padding; i += dashLength * 2) {
                doc.line(i, corteY, i + dashLength, corteY);
            }
            doc.setFont("helvetica", "bold");
            doc.setFontSize(10);
            doc.text("✂", contentX + 2, corteY - 1);

            doc.save("etiqueta.pdf");
            alert("Dados salvos e PDF gerado!");
        }



        function limparFormulario() {
            localStorage.removeItem("etiqueta");
            form.reset();
            alert("Formulário limpo!");
        }
    </script>
</body>

</html>