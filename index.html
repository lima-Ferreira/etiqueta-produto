<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <title>Etiqueta de Identificação</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f8f8ff;
            margin: 0;
            padding: 0;
            height: 100vh;
        }

        header {
            background: purple;
            color: white;
            text-align: center;
            padding: 12px 0 6px 0;
            font-size: 20px;
            font-weight: bold;
            letter-spacing: 2px;
        }

        main {
            max-width: 700px;
            margin: 10px auto;
            background: #fff;
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        label {
            display: block;
            margin-top: 8px;
            font-weight: bold;
            color: purple;
        }

        input,
        select {
            width: 100%;
            padding: 6px;
            margin-top: 3px;
            border: 1px solid #ccc;
            border-radius: 6px;
            font-size: 14px;
        }

        .linha {
            display: flex;
        }

        .linha div {
            flex: 1;
        }

        .linha div+div {
            margin-left: 10px;
        }

        .buttons {
            margin-top: 15px;
            display: flex;
            justify-content: space-between;
        }

        button {
            flex: 1;
            margin: 5px;
            padding: 8px;
            font-size: 14px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: 0.3s;
        }

        .save {
            background: purple;
            color: white;
        }

        .save:hover {
            background: darkmagenta;
        }

        .clear {
            background: #ccc;
        }

        .clear:hover {
            background: #999;
            color: white;
        }
    </style>
</head>

<body>
    <header>ETIQUETA DE IDENTIFICAÇÃO</header>
    <main>
        <form id="etiquetaForm">
            <label>Nome: <input type="text" name="nome"></label>

            <div class="linha">
                <div><label>Endereço:</label><input type="text" name="endereco"></div>
                <div><label>Número:</label><input type="text" name="numero"></div>
            </div>

            <label>Bairro: <input type="text" name="bairro"></label>
            <label>Telefone: <input type="text" name="telefone"></label>
            <label>Produtos: <input type="text" name="produtos"></label>

            <div class="linha">
                <div><label>Número da Venda:</label><input type="text" name="venda"></div>
                <div><label>Número da Nota:</label><input type="text" name="nota"></div>
            </div>

            <div class="linha">
                <div><label>Número de Série:</label><input type="text" name="serie"></div>
                <div><label>Número da OS:</label><input type="text" name="osdaLoja"></div>
            </div>

            <label>Ordem de Serviços: <input type="text" name="ordemServicos"></label>

            <div class="linha">
                <div>
                    <label>Loja de Origem:</label>
                    <select name="lojaOrigem">
                        <option value="">SELECIONAR LOJA DE ORIGEM</option>
                        <option>J O DE LIMA LTDA - MATRIZ</option>
                        <option>J O DE LIMA LTDA - PALHANO</option>
                        <option>J O DE LIMA LTDA - JAGUARUANA</option>
                        <option>J O DE LIMA LTDA - DEPOSITO</option>
                        <option>J O DE LIMA LTDA - LOJA 05</option>
                        <option>J O DE LIMA LTDA - LIMOEIRO</option>
                        <option>J O DE LIMA LTDA - ITAIÇABA</option>
                        <option>J O DE LIMA LTDA - FLORES</option>
                        <option>J O DE LIMA LTDA - ARACATI</option>
                    </select>
                </div>
                <div>
                    <label>Autorizada:</label>
                    <select name="autorizada">
                        <option value="">SELECIONAR AUTORIZADA</option>
                        <option>AUTORIZADA - LIVERTEC</option>
                        <option>AUTORIZADA - ELETRONICA GAUDENCIO</option>
                        <option>AUTORIZADA - ELECTROLUX LIMOEIRO</option>
                        <option>AUTORIZADA - ELETRO REFRIGERAÇAO LIMOEIRENSE</option>
                        <option>AUTORIZADA - WALBER</option>
                        <option>AUTORIZADA - OUTROS</option>
                    </select>
                </div>
            </div>
            <label>Defeito: <input type="text" name="defeito"></label>

            <label>Data: <input type="text" name="dataAtual" readonly></label>

            <div class="buttons">
                <button type="button" class="save" onclick="salvarGerarPDF()">Salvar & Gerar PDF</button>
                <button type="button" class="clear" onclick="limparFormulario()">Limpar Formulário</button>
            </div>
        </form>
    </main>
    <script>
        const form = document.getElementById("etiquetaForm");

        window.onload = () => {
            const dados = JSON.parse(localStorage.getItem("etiqueta")) || {};
            Object.keys(dados).forEach(campo => {
                if (form.elements[campo]) form.elements[campo].value = dados[campo];
            });
            if (!form.elements.dataAtual.value)
                form.elements.dataAtual.value = new Date().toLocaleDateString('pt-BR');
        };

        function salvarGerarPDF() {
            const form = document.getElementById("etiquetaForm");

            // Validação: não gerar PDF se algum input estiver vazio
            const inputs = Array.from(form.elements).filter(el => el.name);
            for (let input of inputs) {
                if (!input.value.trim()) {
                    alert(`O campo "${input.name}" está vazio. Preencha todos os campos antes de gerar o PDF.`);
                    input.focus();
                    return;
                }
            }

            // Coletar dados do formulário
            const dados = {};
            for (let el of inputs) {
                dados[el.name] = el.value;
            }

            localStorage.setItem("etiqueta", JSON.stringify(dados));

            const { jsPDF } = window.jspdf;
            const doc = new jsPDF({ unit: 'mm', format: 'a4' });

            const pageWidth = doc.internal.pageSize.getWidth();
            let y = 1;

            // Header centralizado
            doc.setFont("helvetica", "bold");
            doc.setFontSize(14);
            doc.text("ETIQUETA DE IDENTIFICAÇÃO", pageWidth / 2, y + 3, { align: "center" });

            // Informações da loja e data
            doc.setFont("helvetica", "normal");
            doc.setFontSize(8);
            y += 8;
            const infoHeader = [
                `LOJA DE ORIGEM: ${dados.lojaOrigem.toUpperCase()}`,
                `AUTORIZADA: ${dados.autorizada.toUpperCase()}`,
                `DATA: ${dados.dataAtual.toUpperCase()}`
            ];
            infoHeader.forEach((text, i) => {
                doc.text(text, pageWidth / 2, y + i * 4, { align: "center" });
            });
            y += infoHeader.length * 4 + -2;

            // Caixa principal centralizada
            const contentWidth = pageWidth * 0.7;
            const contentX = (pageWidth - contentWidth) / 2;
            const padding = 3;
            const lineHeight = 3.2;

            // Linhas do conteúdo
            const linhas = [];
            const ordemCampos = [
                "nome", "endereco", "numero", "bairro", "telefone", "produtos",
                "venda", "nota", "serie", "osdaLoja", "ordemServicos", "defeito"
            ];
            let contentHeight = 0;
            for (let campo of ordemCampos) {
                let label = campo.toUpperCase() + ": ";
                let value = dados[campo].toUpperCase();
                linhas.push({ label, value });
                contentHeight += lineHeight + 1.5;
            }

            // Desenhar a borda centralizada
            const contentY = y;
            doc.setDrawColor(50, 50, 50);
            doc.setLineWidth(0.5);
            doc.rect(contentX, contentY, contentWidth, contentHeight + 2 * padding);

            // Inserir a logo dinamicamente no canto superior direito da caixa
            const logoWidth = 20;
            const logoHeight = 10;
            const logoX = contentX + contentWidth - padding - logoWidth;
            const logoY = contentY + padding;

            const img = new Image();
            img.src = "logo.png"; // caminho relativo da logo
            img.onload = function () {
                doc.addImage(img, "PNG", logoX, logoY, logoWidth, logoHeight);

                // Inserir texto dentro da caixa, alinhado à esquerda
                let textY = contentY + padding + 2;
                for (let { label, value } of linhas) {
                    doc.setFont("helvetica", "bold");
                    doc.setFontSize(8);
                    doc.text(label, contentX + padding, textY);

                    doc.setFont("helvetica", "normal");
                    doc.setFontSize(8);
                    const splitText = doc.splitTextToSize(value, contentWidth - doc.getTextWidth(label) - 2 * padding);
                    doc.text(splitText, contentX + padding + doc.getTextWidth(label), textY);

                    textY += Math.max(splitText.length, 1) * lineHeight + 1.5;
                }

                // Linha pontilhada com tesoura
                const corteY = contentY + contentHeight + padding + 5;
                doc.setLineWidth(0.1);
                doc.setDrawColor(0, 0, 0);
                const dashLength = 2;
                for (let i = contentX; i < contentX + contentWidth; i += dashLength * 2) {
                    doc.line(i, corteY, i + dashLength, corteY);
                }
                doc.setFont("helvetica", "bold");
                doc.setFontSize(10);
                doc.text("✂", contentX + 2, corteY - 1);

                // Salvar PDF
                doc.save("etiqueta.pdf");
                alert("Dados salvos e PDF gerado!");
            };
        }



        function limparFormulario() {
            localStorage.removeItem("etiqueta");
            form.reset();
            form.elements.dataAtual.value = new Date().toLocaleDateString('pt-BR');
            alert("Formulário limpo!");
        }
    </script>

</body>

</html>